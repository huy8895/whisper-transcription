name: Generate Slides from JSON

on:
  workflow_dispatch:

jobs:
  create-slides:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ Install dependencies
        run: |
          npm install pptxgenjs

      - name: ğŸ“œ Create PPTX from JSON
        run: |
          cat << 'EOF' > gen_slides.js
          const PPTXGenJS = require("pptxgenjs");
          const fs = require("fs");

          const slideData = JSON.parse(fs.readFileSync("timings.json", "utf8"));
          const pptx = new PPTXGenJS();

          // Set slide size to 1920x1080 pixels
          pptx.defineLayout({ name: "WIDESCREEN_HD", width: 10, height: 5.625 }); // inches
          pptx.layout = "WIDESCREEN_HD";

          const bgPath = "assets/bg.jpg";

          slideData.forEach((item) => {
            const slide = pptx.addSlide();
            slide.background = { path: bgPath };
            slide.addText(item.text, {
              x: 0.5, y: 0.5, w: 9, h: 4.5,
              fontSize: 38,
              color: "404040",
              fontFace: "Crimson Pro",
              align: "justify",
              valign: "top",
              wrap: true,
            });
          });

          pptx.writeFile({ fileName: "slides.pptx" })
            .then(() => console.log("âœ… Created slides.pptx"))
            .catch((err) => {
              console.error("âŒ Error:", err);
              process.exit(1);
            });
          EOF

          node gen_slides.js

      - name: ğŸ–¼ï¸ Install LibreOffice
        run: sudo apt-get update && sudo apt-get install -y libreoffice

      - name: ğŸ–¼ï¸ Convert PPTX to PNG
        run: |
          mkdir -p slides_png
          soffice --headless --convert-to png --outdir slides_png slides.pptx
          echo "âœ… Converted slides:"
          ls slides_png/

      - name: ğŸ—œï¸ Zip PNG images
        run: zip -r slides_png.zip slides_png

      - name: ğŸ“¤ Upload artifact (ZIP)
        uses: actions/upload-artifact@v4
        with:
          name: slides_images
          path: slides_png.zip
