name: Test PPTX to Images

on:
  workflow_dispatch:

jobs:
  generate-slides:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install pptxgenjs dependency
        run: npm install pptxgenjs

      - name: Generate PPTX slides
        run: |
          cat << 'EOF' > gen_slides.js
          const PPTXGenJS = require("pptxgenjs");
          let pptx = new PPTXGenJS();
          let slide = pptx.addSlide();
          slide.addText("Hello, world!", { x: 1, y: 1, fontSize: 24, color: "363636" });
          pptx.writeFile({ fileName: "slides.pptx" }).then(() => {
            console.log("slides.pptx generated");
          }).catch(err => {
            console.error(err);
            process.exit(1);
          });
          EOF
          node gen_slides.js

      - name: Install LibreOffice
        run: |
          sudo apt-get update
          sudo apt-get install -y libreoffice

      - name: Convert PPTX to PNG images
        run: |
          mkdir -p slides_png
          soffice --headless --convert-to png --outdir slides_png slides.pptx
          echo "Converted PPTX to PNG images:"
          ls slides_png/

      - name: Zip PNG images
        run: zip -r slides_png.zip slides_png

      - name: Upload ZIP artifact
        uses: actions/upload-artifact@v4
        with:
          name: slides_images_zip
          path: slides_png.zip
